<h1>Books</h1>

<div style="text-align:center">
  <% if can? :create, Book %>
    <%= link_to "New book", new_book_path %>
  <% end %>
</div>
<br>
<div>
 <table class="table table-striped">
      <tr>
        <th scope="col">ID</th>
        <th scope="col"></th>
        <th scope="col">Title</th>
        <th scope="col">Author</th>
        <th scope="col">Genre</th>
        <th scope="col">Year</th>
        <th scope="col"></th>
      </tr>
      <% @books.each do |book| %>
      <tr>
        <td><%= book.id %></td>
        <% if book.cover.attached? %>
        <%# if book.cover_path.present? %>
          <!--<td><img src="<%#= image_path('books/'+book.id.to_s+'.png') %>" width="150px"></td>
          <td style="text-align:center"><img src="<%#= image_path('books/'+book.cover_path+'') %>" width="150px"></td>-->
          <td style="text-align:center"><%= image_tag(book.cover, class: "cover-i") %></td>
        <% else %>
          <!--<td><img src="<%= image_path('books/noCoverImage.jpg') %>" width="150px"></td>-->
          <td style="text-align:center"><i >no cover image</i></td>
        <% end %>
        <td><%= link_to book.title, book %></td>
        <!--<td><%#= book.title %></td>-->
        <td><%= link_to Author.find(book.author_id).name, author_path(book.author_id) %></td>
        <td>
          <% Genre.where(id:BookGenre.where(book_id:book).select(:genre_id)).select(:id, :category).each do |genre| %>     
            <% unless genre.category == Genre.where(id:BookGenre.where(book_id:book).select(:genre_id)).select(:category).last.category %>
              <%=h link_to genre.category, search_genres_path(id: genre.id) %>,
            <% else %>
              <%=h link_to genre.category, search_genres_path(id: genre.id) %>
            <% end %>
          <% end %>
        </td>
        <td><%= book.year %></td>
        <td><%#= link_to "Show this book", book %></td>
      <tr>
    <% end %>
  </table>
</div>
<br>
<%= render partial: "shared/pagination" %>